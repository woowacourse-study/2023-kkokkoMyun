## 웹 사이트를 제작했는데 고해상도 이미지를 많이 사용하여 페이지 로딩 속도가 느립니다. 최적화 하는 방법에 대해서 모두 설명하세요.

### 개념 설명

1. 이미지 최적화
2. CDN 사용
3. 브라우저 캐싱 활용
4. Lazy Loading 구현
5. CSS Sprite
6. 이미지 사전 로딩
7. 서버 사이드 최적화 (DB 쿼리 최적화)
8. 웹페이지 구조 최적화

등이 있지만, 백엔드 개발자가 고려할 수 있는 사항에는 HTTP Caching이 가장 대표적일 것 같습니다.

## 꼬리 질문

### HTTP Caching이 무엇이고 왜 사용하는지에 대해 설명해보시겠습니까?

<details>
<summary>답변</summary>
<div markdown="1">

    - HTTP Caching
        - 의미: 웹 리소스를 클라이언트의 로컬 저장소에 저장하여, 동일한 리소스에 대한 재요청 시 서버에 다시 요청하지 않고 로컬에 저장된 리소스를 사용하는 기법입니다.
        - 효과:
            - 불필요한 데이터 전송을 줄여서 네트워크로 인한 비용을 줄여줍니다.
            - 네트워크 병목을 줄여줘, 대역폭을 늘리지 않아도 리소스를 빨리 불러올 수 있습니다.
            - 원 서버에 대한 요청을 줄여줘서 서버의 부하를 줄일 수 있습니다.
            - 거리로 인한 지연을 줄여줍니다.

</div>
</details>

### 캐시가 저장되는 위치에 대해서 설명해주시겠습니까?

<details>
<summary>답변</summary>
<div markdown="1">

    캐시의 성격별로 저장되는 위치가 다릅니다.

    private cache
        - 브라우저
        - 개인화된 콘텐츠나 보안적으로 중요한 정보를 저장함
        - Cache-Control 헤더에 private이 설정되면 개인 캐시에 저장된다.
    Shared Cache
        - 프록시 서버, CDN
        - 여러 사용자가 접근할 수 있는 캐시, 공통으로 제공되는 리소스 저장함
        - Cache-Control 헤더에 public이 설정되면 개인 캐시에 저장된다.

</div>
</details>

### HTTP GET 요청의 캐시 처리 절차에 대해 설명해보시겠습니까?

<details>
<summary>답변</summary>
<div markdown="1">

    - 기본적인 캐시 처리 절차는 총 일곱단계로 이루어져있습니다.
    - 단계 별 설명
        1. 요청 받기: 네트워크로부터 도착한 요청 메시지를 읽습니다.
        2. 파싱: 메시지를 파싱하여 URI와 헤더들을 추출합니다.
        3. 검색: 로컬 복사본이 있는지 검사하고, 사본이 없다면 사본을 받아와서 로컬에 저장합니다.
        4. 신선도 검사: 캐시된 사본이 충분히 신선한지 검사하고, 신선하지 않다면 변경사항이 있는지 서버에 확인합니다.
        5. 응답 생성: 새로운 헤더와 캐시된 본문으로 응답 메시지를 만듭니다.
        6. 발송: 네트워크를 통해 응답을 클라이언트에게 돌려줍니다.
        7. 로깅: 선택적으로 로그파일에 트랜잭션에 대해 서술한 로그를 남깁니다.

</div>
</details>

### 캐시된 사본이 충분히 신선한지 어떻게 판단할 수 있습니까?

<details>
<summary>답변</summary>
<div markdown="1">

    - HTTP 헤더를 이용해서 판단할 수 있습니다.
    - Cache-Control 헤더
        - maxAge: 초 단위로 명시하여. 해당 초가 지나면 더 이상 신선하지 않다고 간주함
        - must-revalidate: 캐시된 복사본이 만료되었다면, 캐시가 이 복사본을 사용하기 전에 반드시 원래 서버로 가서 리소스의 유효성을 재검증하도록 강제한다.
    - Expires 헤더
        - 유효기간을 명시하며, 해당 시점 이후에는 신선하지 않다고 간주함
        - 서버들마다 시간이 다를 수 있다는 문제점 때문에 maxAge를 사용하는 것을 권장한다.
    - Validation 헤더
        - ETag/If-None-Match
            - 서버가 생성한 리소스의 버전을 나타내는 값이다.
            - 클라이언트가 이후에 같은 리소스를 요청할 때, If-None-Match 헤더에 캐시된 태그(ETag)를 추가한 후 요청에 포함하여 서버에 보냅니다.
            - 서버에 있는 문서와 일치하지 않을 때(none match)에 요청을 처리한다.
        - Last-Modified/If-Modified-Since
            - 서버는 요청에 응답할 때, 헤더에 리소스가 마지막으로 수정된 시간인 Last-Modified를 추가한다.
            - 클라이언트가 이후에 같은 리소스를 요청할 때, If-Modified-Since 헤더에 Last-Modified 추가한 후 요청에 포함하여 서버에 보냅니다.
            - 서버에 있는 문서가 추후에 수정되었을 때, 해당 요청을 처리합니다.

</div>
</details>

### 캐시된 사본이 충분히 신선한지 어떻게 판단할 수 있습니까?

<details>
<summary>답변</summary>
<div markdown="1">

    - HTTP 헤더를 이용해서 판단할 수 있습니다.
    - Cache-Control 헤더
        - maxAge: 초 단위로 명시하여. 해당 초가 지나면 더 이상 신선하지 않다고 간주함
        - must-revalidate: 캐시된 복사본이 만료되었다면, 캐시가 이 복사본을 사용하기 전에 반드시 원래 서버로 가서 리소스의 유효성을 재검증하도록 강제한다.
    - Expires 헤더
        - 유효기간을 명시하며, 해당 시점 이후에는 신선하지 않다고 간주함
        - 서버들마다 시간이 다를 수 있다는 문제점 때문에 maxAge를 사용하는 것을 권장한다.
    - Validation 헤더
        - ETag/If-None-Match
            - 서버가 생성한 리소스의 버전을 나타내는 값이다.
            - 클라이언트가 이후에 같은 리소스를 요청할 때, If-None-Match 헤더에 캐시된 태그(ETag)를 추가한 후 요청에 포함하여 서버에 보냅니다.
            - 서버에 있는 문서와 일치하지 않을 때(none match)에 요청을 처리한다.
        - Last-Modified/If-Modified-Since
            - 서버는 요청에 응답할 때, 헤더에 리소스가 마지막으로 수정된 시간인 Last-Modified를 추가한다.
            - 클라이언트가 이후에 같은 리소스를 요청할 때, If-Modified-Since 헤더에 Last-Modified 추가한 후 요청에 포함하여 서버에 보냅니다.
            - 서버에 있는 문서가 추후에 수정되었을 때, 해당 요청을 처리합니다.

</div>
</details>

### 캐시된 리소스와 실제 API 명세 사이에 차이가 생긴다면 어떻게 대처하시겠습니까?

<details>
<summary>답변</summary>
<div markdown="1">

    - JS, CSS 등의 정적 리소스 파일의 경우 리소스 버전이 API 명세와 차이가 생긴다면 화면이 깨질 수 있습니다.
    - 해당 문제를 해결하기 위해서는 저장된 캐시를 무효화 시켜야합니다.
    - 캐시를 무효화 시키는 방법
        - ETag 또는 Last-Modified 헤더 변경
            - 조건부 메서드를 이용해서 새로운 사본을 받아가도록 할 수 있습니다.
        - 캐시 무효화 URL
            - 캐시는 URL 기반으로 리소스를 구분하므로 리소스가 업데이트될 때 URL을 변경하면 손쉽게 JS, CSS 파일의 캐시를 제거할 수 있다.
            - 쿼리 혹은 파일명에 버전을 추가한다
                - 파일명을 바꾸는 쪽을 더 권장한다.
            - 서버 설정을 통해 URL을 재작성한다.

</div>
</details>

## 참고 자료 및 레퍼런스

- 우아한테크코스 레벨 4/Tomcat 구현하기/HTTP 활용하기
- HTTP 완벽 가이드
- [웹 성능을 위한 이미지 최적화](https://velog.io/@hustle-dev/%EC%9B%B9-%EC%84%B1%EB%8A%A5%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94)
